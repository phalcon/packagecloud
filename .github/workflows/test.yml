name: First attempt

on:
  push

jobs:
  build:
    strategy:
      matrix:
        BUILDTAB:
          - ubuntu trusty deb v4.1.2 7.3 stable -

    runs-on: ubuntu-18.04

    env:
      BUILDTAB: ${BUILDTAB}

    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 1

      - name: Before install
        run: |
          source environment
          export $(cat environment | grep -v "^#\|^$" | cut -d= -f1)
          source ci/export-buildtab.sh

      - name: Install
        run: |
          ./ci/install-php.sh
          source ./ci/setup-build.sh
          ./ci/install-re2c.sh
          ./ci/install-zephir-parser.sh
          ./ci/install-zephir.sh

      - run: ./ci/regenerate-build.sh

      - run: make -f .travis.mk ${TARGET}
